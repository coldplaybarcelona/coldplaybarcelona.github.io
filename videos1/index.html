<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Multiple Video Players with Chromecast</title>
    <link rel="stylesheet" href="https://cdn.plyr.io/3.7.8/plyr.css" />
    <script type="text/javascript" src="https://www.gstatic.com/cv/js/sender/v1/cast_sender.js?loadCastFramework=1"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f4;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }
        .video-container {
            width: 80%;
            max-width: 800px;
            position: relative;
            margin-bottom: 20px;
        }
        .error-message {
            color: red;
            margin-top: 10px;
        }
        .castButton {
            position: absolute;
            top: 10px;
            right: 10px;
            z-index: 10;
            background: rgba(0, 0, 0, 0.6);
            border: none;
            color: white;
            padding: 5px;
            border-radius: 3px;
            cursor: pointer;
        }
        .castButton svg {
            width: 24px;
            height: 24px;
        }
    </style>
</head>
<body>
    <div id="videoPlayers">
        <div class="video-container" id="videoContainer1">
            <video id="player1" playsinline controls data-poster="">
                <source src="video1.mp4" type="video/mp4" />
                Your browser does not support the video tag.
            </video>
            <button id="castButton1" class="castButton" style="display:none;">
                <svg viewBox="0 0 24 24">
                    <path d="M1 18v3h3c0-1.66-1.34-3-3-3zm0-4v2c2.76 0 5 2.24 5 5h2c0-3.87-3.13-7-7-7zm18-7H5v1.63c3.96 1.28 7.09 4.41 8.37 8.37H19V7zM1 10v2c4.97 0 9 4.03 9 9h2c0-6.08-4.93-11-11-11zm20-7H3c-1.1 0-2 .9-2 2v3h2V5h18v14h-7v2h7c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2z" fill="currentColor"/>
                </svg>
            </button>
            <div class="error-message" id="errorMessage1" style="display:none;"></div>
        </div>

        <div class="video-container" id="videoContainer2">
            <video id="player2" playsinline controls data-poster="">
                <source src="video2.mp4" type="video/mp4" />
                Your browser does not support the video tag.
            </video>
            <button id="castButton2" class="castButton" style="display:none;">
                <svg viewBox="0 0 24 24">
                    <path d="M1 18v3h3c0-1.66-1.34-3-3-3zm0-4v2c2.76 0 5 2.24 5 5h2c0-3.87-3.13-7-7-7zm18-7H5v1.63c3.96 1.28 7.09 4.41 8.37 8.37H19V7zM1 10v2c4.97 0 9 4.03 9 9h2c0-6.08-4.93-11-11-11zm20-7H3c-1.1 0-2 .9-2 2v3h2V5h18v14h-7v2h7c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2z" fill="currentColor"/>
                </svg>
            </button>
            <div class="error-message" id="errorMessage2" style="display:none;"></div>
        </div>

        <div class="video-container" id="videoContainer3">
            <video id="player3" playsinline controls data-poster="">
                <source src="video3.mp4" type="video/mp4" />
                Your browser does not support the video tag.
            </video>
            <button id="castButton3" class="castButton" style="display:none;">
                <svg viewBox="0 0 24 24">
                    <path d="M1 18v3h3c0-1.66-1.34-3-3-3zm0-4v2c2.76 0 5 2.24 5 5h2c0-3.87-3.13-7-7-7zm18-7H5v1.63c3.96 1.28 7.09 4.41 8.37 8.37H19V7zM1 10v2c4.97 0 9 4.03 9 9h2c0-6.08-4.93-11-11-11zm20-7H3c-1.1 0-2 .9-2 2v3h2V5h18v14h-7v2h7c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2z" fill="currentColor"/>
                </svg>
            </button>
            <div class="error-message" id="errorMessage3" style="display:none;"></div>
        </div>

        <div class="video-container" id="videoContainer4">
            <video id="player4" playsinline controls data-poster="">
                <source src="video4.mp4" type="video/mp4" />
                Your browser does not support the video tag.
            </video>
            <button id="castButton4" class="castButton" style="display:none;">
                <svg viewBox="0 0 24 24">
                    <path d="M1 18v3h3c0-1.66-1.34-3-3-3zm0-4v2c2.76 0 5 2.24 5 5h2c0-3.87-3.13-7-7-7zm18-7H5v1.63c3.96 1.28 7.09 4.41 8.37 8.37H19V7zM1 10v2c4.97 0 9 4.03 9 9h2c0-6.08-4.93-11-11-11zm20-7H3c-1.1 0-2 .9-2 2v3h2V5h18v14h-7v2h7c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2z" fill="currentColor"/>
                </svg>
            </button>
            <div class="error-message" id="errorMessage4" style="display:none;"></div>
        </div>
    </div>

    <script src="https://cdn.plyr.io/3.7.8/plyr.polyfilled.js"></script>
    <script>
        // Initialize Plyr for each video
        const players = Plyr.setup('.video-container video', {
            controls: ['play-large', 'play', 'progress', 'current-time', 'mute', 'volume', 'captions', 'settings', 'pip', 'airplay', 'fullscreen']
        });

        // Hide cast buttons when videos start playing
        players.forEach((player, index) => {
            player.on('play', () => {
                document.getElementById(`castButton${index + 1}`).style.display = 'none';
            });
        });

        // Check Cast API availability
        function checkCastApiAvailability() {
            if (window.chrome && window.chrome.cast && window.chrome.cast.isAvailable) {
                initializeCastApi();
            } else {
                setTimeout(checkCastApiAvailability, 1000);
            }
        }

        window.addEventListener('load', checkCastApiAvailability);

        function initializeCastApi() {
            try {
                const context = cast.framework.CastContext.getInstance();
                context.setOptions({
                    receiverApplicationId: chrome.cast.media.DEFAULT_MEDIA_RECEIVER_APP_ID,
                    autoJoinPolicy: chrome.cast.AutoJoinPolicy.ORIGIN_SCOPED
                });

                const castButtons = document.querySelectorAll('.castButton');

                // Show/hide cast buttons based on cast state
                context.addEventListener(cast.framework.CastContextEventType.CAST_STATE_CHANGED, function(event) {
                    const display = event.castState !== cast.framework.CastState.NO_DEVICES_AVAILABLE ? 'block' : 'none';
                    castButtons.forEach(button => button.style.display = display);
                });

                // Cast button click event
                castButtons.forEach((button, index) => {
                    button.addEventListener('click', function() {
                        if (context.getCastState() === cast.framework.CastState.CONNECTED) {
                            context.endCurrentSession(true);
                        } else {
                            context.requestSession().then(
                                function() {
                                    loadMedia(players[index]);
                                },
                                function(error) {
                                    showErrorMessage(`Error connecting to Cast: ${error.description}`, index + 1);
                                }
                            );
                        }
                    });
                });
            } catch (error) {
                console.error('Error initializing Cast API:', error);
            }
        }

        function loadMedia(player) {
            const context = cast.framework.CastContext.getInstance();
            const session = context.getCurrentSession();
            if (session) {
                const mediaInfo = new chrome.cast.media.MediaInfo(player.source, 'video/mp4');
                mediaInfo.metadata = new chrome.cast.media.GenericMediaMetadata();
                mediaInfo.metadata.title = 'Video Title';
                const request = new chrome.cast.media.LoadRequest(mediaInfo);
                session.loadMedia(request).then(
                    function() {
                        console.log('Media loaded successfully');
                        document.querySelectorAll('.error-message').forEach(el => el.style.display = 'none');
                    },
                    function(error) {
                        showErrorMessage(`Error loading media: ${error.description}`, player.id.slice(-1));
                    }
                );
            }
        }

        function showErrorMessage(message, playerIndex) {
            const errorMessageDiv = document.getElementById(`errorMessage${playerIndex}`);
            errorMessageDiv.textContent = message;
            errorMessageDiv.style.display = 'block';
        }
    </script>
</body>
</html>
